
<link rel="stylesheet" href="~/adminLTE/dist/css/Orders.css" />
<style>
    .custom-scroll {
        max-height: 150px;
        overflow-y: scroll;
        scrollbar-width: none;
        -ms-overflow-style: none;
        
    }

        .custom-scroll::-webkit-scrollbar {
            display: none;
        }

    input[name=company]:checked::before {
        content: "";
        display: block;
        position: relative;
        text-align: center;
        height: 17px;
        width: 17px;
        background-color: #fff;
        color: #fff;
        font-family: "Montserrat";
        border-radius: 3px;
        border: 2px solid #77D4FC;
    }

    input[name=company]:checked::after {
        content: url('data:image/svg+xml; utf8, <svg xmlns="http://www.w3.org/2000/svg" width="11" height="11" fill="skyBlue" viewBox="0 0 24 24"><path d="M20.285 2l-11.285 11.567-5.286-5.011-3.714 3.716 9 8.728 15-15.285z"/></svg>');
        display: block;
        position: relative;
        left: 3px;
        top: -20px;
    }

    input[type='checkbox'] {
        accent-color: #fff;
        position: relative;
        margin-right: 10px;
        width: 16px;
        height: 16px;
        top: 3px !important;
    }

    @@media(max-width:765px) {
        input[name=company]:checked::after {
            top: -18px !important;
        }
    }

    input[name=chef]:checked::before {
        content: "";
        display: block;
        position: relative;
        text-align: center;
        height: 17px;
        width: 17px;
        background-color: #fff;
        color: #fff;
        font-family: "Montserrat";
        border-radius: 3px;
        border: 2px solid #77D4FC;
    }

    input[name=chef]:checked::after {
        content: url('data:image/svg+xml; utf8, <svg xmlns="http://www.w3.org/2000/svg" width="11" height="11" fill="skyBlue" viewBox="0 0 24 24"><path d="M20.285 2l-11.285 11.567-5.286-5.011-3.714 3.716 9 8.728 15-15.285z"/></svg>');
        display: block;
        position: relative;
        left: 3px;
        top: -20px;
    }

    @@media(max-width:765px) {
        input[name=chef]:checked::after {
            top: -18px !important;
        }
    }
</style>
<div class="container-fluid">
    <h3>
        <span class="vertical-line mr-2"></span>
        Orders
    </h3>
    <div class="card mt-3" style="border-radius: 15px;">
        <div class="card-body">
            <div class="row">
                <div class="col-sm-12 col-md-12">
                    <div class="buttons">
                        <button class="btn btn-theme3 btnstyle classcss selectedButton" id="btn-1" data-statusId="0">All</button>
                        <button class="btn btn-theme3 btnstyle classcss" id="btn-2" data-statusId="1">Pending</button>
                        <button class="btn btn-theme3 btnstyle classcss" id="btn-3" data-statusId="2">Completed</button>
                        <button class="btn btn-default btn-filter" id="btn-filter"><i><img src="/Images/setting.png" width="10" /></i> &nbsp; Filters</button>
                    </div>
                </div>

            </div>
        </div>
        <div class="table-responsive" style="padding:0px 25px 25px 25px;">

            <table class="table table-bordered w-100 no-wrap" id="table-orders">
                <thead>
                    <tr class="table-active">
                        <th class="no-wrap">Id</th>
                        <th class="no-wrap">
                            Order ID #
                        </th>
                        <th class="no-wrap">
                            User Name
                        </th>
                        <th class="no-wrap">
                            Order Time
                        </th>
                        <th class="no-wrap">
                            Meal
                        </th>
                        <th class="no-wrap">
                            Choice
                        </th>
                        <th class="no-wrap">
                            Side
                        </th>
                        <th class="no-wrap">
                            Request
                        </th>
                        <th class="no-wrap">
                            Received
                        </th>
                        <th class="no-wrap">
                            Delivered At
                        </th>
                        <th>
                            Status
                        </th>
                        <th class="no-wrap">
                            Order Details
                        </th>
                        <th>
                            Ratings
                        </th>
@*                        <th>
                            Action
                        </th>*@
                    </tr>

                </thead>
                <tbody>
                    <tr>
                        <td>
                            12341234
                        </td>
                        <td class="no-wrap">
                            <img src="~/Images/Ellipse 1267.png" />
                            john Doe
                        </td>
                        <td class="no-wrap">
                            Company 1
                        </td>

                        <td class="no-wrap">
                            Chef John Doe
                        </td>
                        <td style="text-align:center; cursor: pointer;">
                            <span class="white-eye" id="order1-Id">
                                <span class="fas fa-eye"></span>
                            </span>
                        </td>
                        <td class="no-wrap">
                            12 Aug 2023 11:00 am
                        </td>
                        <td>
                            Not Yet
                        </td>

                        <td class="no-wrap">
                            Not Yet
                        </td>

                        <td>
                            <span class="spanGreen" id="active-id"> Completed</span>
                            <span class="spanRed d-none" id="block-id"> Pending</span>

                        </td>
                        <td class="no-wrap" style="text-align:center;">
                            <div class="dropdown">
                                <div class="horizontal-ellipsis">&#8942;</div>
                                <div class="dropdown-content">

                                    <a href="#" id="btn-unblock" value="unblock">Mark Complete</a>
                                    @*                                    <a href="#" id="btn-block" value="block">Block</a>
                                    *@
                                </div>
                            </div>

                        </td>

                    </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

@* Order Detail Modal *@
<div class="modal fade" id="order_detail_modal" role="dialog">
    <div class="modal-dialog modal-md">
        <!-- Modal content-->
        <div class="modal-content" style="border-radius: 30px;">
            <div class="modal-header">
                <b id="orderId" class="modal-title" style="font-size:18px;">Order ID: 1231223</b>

                <a class="close" data-dismiss="modal" aria-label="Close">
                    &times;
                </a>
            </div>
            <div class="modal-body justify-content-center " style=" padding: 20px;">
                <div class="row">
                    <div class="col-md-6" id="appendstatus">
                        <span class="spandefault " id="pending-id"> Pending</span>

                    </div>
                    <div class="col-md-6">
                        <div id="appendstars" class="float-right">
                            <i class="fontcolor  fas fa-star"></i>
                            <i class="fontcolor  fas fa-star"></i>
                            <i class="fontcolor fas fa-star"></i>
                            <i class="fontcolor fas fa-star"></i>
                            <i class="fontcolor  fas fa-star"></i>
                        </div>
                    </div>
                </div>
                <br />
                <div style="padding:10px;">
                    <div class="row mb-2">
                        <i class="far fa-clock" style="color: #b0b8c4;font-size:20px;"></i>
                        <span style="margin-left: 10px; margin-top:-2px; font-family: PoppinsFont;" class="heading"> Time Slot</span>
                    </div>
                    <div class="row mb-2" id="timeslot">
                    </div>

                    <div class="mb-2" id="appendcategories"></div>
                    <div class="row mb-2">
                        <img src="~/Images/Path 281648.png" />
                        <span style="margin-left: 10px; font-family: PoppinsFont;" class="heading"> Special Request</span>
                    </div>
                    <div class="row mb-2" id="appendrequest">

                        <span style="margin-left: 13px;">
                            <b>
                                Lorem ipsum dolor sit amet, ahjads consect.
                                imagna aliqua Lorem ipsum sitm dol. .
                                imagna aliqua Lorem ipsum sitm dol
                            </b>
                        </span>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

@* //View Profile Modal *@
<div class="modal fade" id="user-detail-modal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content" style="border-radius: 30px;">
            <div class="modal-header">
                <b class="modal-title" style="font-family : poppinssemibold;">User Detail</b>

                <a class="close cross" data-dismiss="modal" aria-label="Close">
                    &times;
                </a>
            </div>

            <div class="modal-body">

                <div class="login-logo" id="userImage">
                    <img src="~/Images/image_2023_08_17T13_03_37_430Z.png" style="padding : 10px;" width="150" alt="User Image">

                </div>
                <div class="row px-2 py-2" style="line-height: 2;">
                    <div class="col-md-6"><span style="font-family: PoppinsFontmedium;">Full Name</span></div>
                    <div class="col-md-6"><span style="float:right ;" class="text-muted" id="userName">John Doe</span></div>
                </div>
                <div class="row px-2 py-2" style="line-height: 2;">
                    <div class="col-md-6"><span style="font-family: PoppinsFontmedium;">Email</span></div>
                    <div class="col-md-6"><span style="float:right ;" class="text-muted" id="userEmail">Johnoe@gmail.com</span></div>
                </div>
                <div class="row px-2 py-2 d-none" style="line-height: 2;">
                    <div class="col-md-6"><span style="font-family: PoppinsFontmedium;">Phone Number</span></div>
                    <div class="col-md-6"><span style="float:right ;" class="text-muted" id="userPhone">(+92)330-1234321</span></div>
                </div>
                <div class="row px-2 py-2" style="line-height: 2;">
                    <div class="col-md-6" style="font-family:PoppinsFontmedium !important;"><span>Allergies</span></div>
                </div>

                <div id="appendallergies" class="row p-1 ml-1" style="font-family:PoppinsFontmedium !important;">
                    <span class="Alergies">&nbsp;Wheat</span>
                    <span class="Alergies">&nbsp;&nbsp;&nbsp;Gluten</span>
                    <span class="Alergies">&nbsp;&nbsp;&nbsp;Egg</span>
                    <span class="Alergies">&nbsp;&nbsp;&nbsp;Peanuts</span>

                </div>

                <br>

            </div>
        </div>
    </div>
</div>

@* Filter Modal *@
<div class="modal custom show @* fade *@" id="filter-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content" style=" border-radius: 22px 0px 0px 22px">
            <div class="modal-header">
                <span id="exampleModalLabel" class="filter-span"><b class="modal-title">Filters</b></span>
                <a class=" clearAll" id="btnClearAll">
                    Clear All
                </a>
            </div>
            <div class="modal-body orderfiltermodal">
                <!-- Search Bar with Icon -->
                <div class=" mb-3 pading ">
                    <input type="text" class="form-control borderRadius inputSearchPadding" id="input-search" maxlength="50" placeholder="Search text">
                    <i class="fas fa-search searchIcon"></i>
                </div>


                @* accordions *@

                <div class="accordion">
                    <div class="accordion-item">
                        <div class="accordion-header poppins mr-3 ml-4">
                            By Company <span class="chevron"><i class="fas fa-chevron-down"></i></span>@* chevron &#9660 *@
                        </div>
                        <div class="accordion-content p-3 custom-scroll">
                            <div class="user_dw_menu p-0" id="company-list">
                                <div class="company text-center">
                                    <span id="notFoundMessageCompany" class="text-danger poppin-m lableFont text-center" style="display: none;">Not Company Found!</span>

                                </div>
                                <li style="list-style:none;">
                                    <label class="dropdown-item poppin-m lableFont" for="c1" title="Filter">
                                        <input id="c1" type="checkbox" />
                                        Company 1
                                    </label>
                                </li>
                                <li style="list-style:none;">
                                    <label class="dropdown-item poppin-m lableFont" for="c2" title="Filter">
                                        <input id="c2" type="checkbox" />
                                        Company 2
                                    </label>
                                </li>
                                <li style="list-style:none;">
                                    <label class="dropdown-item poppin-m lableFont" for="c3" title="Filter">
                                        <input id="c3" type="checkbox" />
                                        Company 3
                                    </label>
                                </li>
                                <li style="list-style:none;">
                                    <label class="dropdown-item poppin-m lableFont" for="c4" title="Filter">
                                        <input id="c4" type="checkbox" />
                                        Company 4
                                    </label>
                                </li>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <div class="accordion-header poppins mr-3 ml-4">
                            By Chef <span class="chevron"> <i class="fas fa-chevron-down"></i></span>
                        </div>
                        <div class="accordion-content p-3 custom-scroll">
                            <div class="user_dw_menu p-0" id="chef-list">
                                <div class="chef text-center">
                                    <span id="notFoundMessageChef" class="text-danger poppin-m lableFont text-center" style="display: none;">No Chef Found!</span>

                                </div>
                                <li style="list-style:none;">
                                    <label class="dropdown-item poppin-m lableFont" for="ch1" title="Filter">
                                        <input id="ch1" type="checkbox" />
                                        Chef 1
                                    </label>
                                </li>
                                <li style="list-style:none;">
                                    <label class="dropdown-item poppin-m lableFont" for="ch2" title="Filter">
                                        <input id="ch2" type="checkbox" />
                                        Chef 2
                                    </label>
                                </li>
                                <li style="list-style:none;">
                                    <label class="dropdown-item poppin-m lableFont" for="ch3" title="Filter">
                                        <input id="ch3" type="checkbox" />
                                        Chef 3
                                    </label>
                                </li>
                                <li style="list-style:none;">
                                    <label class="dropdown-item poppin-m lableFont" for="ch4" title="Filter">
                                        <input id="ch4" type="checkbox" />
                                        Chef 4
                                    </label>
                                </li>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer d-flex justify-content-center">
                <button type="button" class="btn btn-theme2 btnbutton active" onclick="orderFilters()">Apply Filters</button>
            </div>
        </div>
    </div>
</div>
<input id="statusType" type="hidden" val="0" />
<script>
    var companyIds = [];
    var chefIds = [];
    var baseUrl = (window.location).href; // You can also use document.URL
    var Id = baseUrl.substring(baseUrl.lastIndexOf('=') + 1);

    $(function () {

        var columns = [
            {
                "data": "id",
                "name": "id"
            },
            {
                "data": "orderId",
                "name": "orderId",
                "render": function (data, row, payload) {
                    return '<span>' + data + '</span>';
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    var imageUrl = "";
                    if (CheckNullUndefined(payload.userPic)) {
                        imageUrl = "/content/dist/img/user-dummy.png";
                    }
                    else {
                        imageUrl = payload.userPic;
                    }
                    return `<a style="cursor:pointer;" onclick="showUserDetailModal('${payload.userId}')"> <div class="user-block" style = "float: none!important;">
                                            <img class="img-circle" src ="${imageUrl}">
                                                <span class="username"> ${payload.userName}</span>
                                        </div></a>`;
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    return '<span>' + payload.timeSlot + '</span>';
                }
            },
            {
                "data": "mealName",
                "name": "mealName",
                "render": function (data, row, payload) {
                    return '<span>' + data + '</span>';
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    var choice = "";
                    if (CheckNullUndefined(payload.mealChoice)) {
                        choice = "N/A";
                    }
                    else {
                        choice = payload.mealChoice;
                    }
                    return '<span>' + choice + '</span>';
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    var choice = "";
                    if (CheckNullUndefined(payload.mealSide)) {
                        choice = "N/A";
                    }
                    else {
                        choice = payload.mealSide;
                    }
                    return '<span>' + choice + '</span>';
                }
            },
            {
                "data": "specialRequest",
                "name": "specialRequest",
                "render": function (data, row, payload) {
                    var rqeuest = "";
                    if (CheckNullUndefined(data)) {
                        request = "N/A";
                    }
                    else {
                        request = data;
                    }
                    return '<span>' + request + '</span>';
                }
            },
            //{
            //    "data": "chefName",
            //    "name": "chefName",
            //    "render": function (data, row, payload) {
            //        return '<span>' + data + '</span>';
            //    }
            //},
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    return '<span>' + payload.orderReceived + '</span>';
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    return '<span>' + payload.orderDelivered + '</span>';
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    if (payload.orderStatus == 0) {
                        return `<div class="no-wrap"style="text-align:center;">
                                                                                <div class="dropdown show">
                                                                                                      <a class="dropdown" href="#" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                                                                <span class="spandefault rounded py-2 px-2">&nbsp;&nbsp;&nbsp;Pending&nbsp;&nbsp;&nbsp;</span>
                                                                                                  </a>
                                                                                                  <div class="dropdown-menu dropopen" aria-labelledby="dropdownMenuLink">
                                                                                                        <a class="dropdown-item cursor-pointer" id="orderMarkBtn" data-orderId=${data} data-status=${1}>Mark Complete</a>
                                                                                                  </div>
                                                                                                </div>
                                                                                                </div>`;
                        //return '<div style="text-align:center;"><span class="spandefault rounded py-2 px-2">&nbsp;&nbsp;Pending&nbsp;&nbsp;</span></div>';
                    }
                    else {
                        return '<div style="text-align:center;"><span class="bg-success rounded py-2 px-2">Completed</span></div>';
                    }
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    return `<a title="OrderDetail" id="order_details" class="btn-sm btn-white-eye orderdetail" style="text-align:center; cursor: pointer;" onclick="showOrderDetailModal('${data}')"><i class="fas fa-eye"></i></a>`;
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    if (payload.orderRating == null) {
                        return '<span>Not yet</span>';
                    }
                    else {
                        if (payload.orderRating == 0) {
                            return '<span>Not yet</span>';
                        }
                        else {
                            return '<span><i class="text-warning fas fa-star"></i>' + payload.orderRating + '</span>';
                        }
                    }
                }
            }
            //{
            //    "data": "id",
            //    "name": "id",
            //    "render": function (data, row, payload) {
            //        if (payload.orderStatus == 1) {
            //            return 'N/A';
            //        }
            //        else {
            //            return `<div class="no-wrap"style="text-align:center;">
            //                                                            <div class="dropdown show">
            //                                                                                  <a class="dropdown actionBtn" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            //                                                                                <i class="fas fa-ellipsis-h"></i>
            //                                                                              </a>
            //                                                                              <div class="dropdown-menu dropopen" aria-labelledby="dropdownMenuLink">
            //                                                                                    <a class="dropdown-item cursor-pointer" id="orderMarkBtn" data-orderId=${data} data-status=${1}>Mark Complete</a>
            //                                                                              </div>
            //                                                                            </div>
            //                                                                            </div>`;
            //        }
            //    }
            //}
        ];

        var order = [[0, "desc"]];
        var columnDefs = [{
            "targets": [0],
            "visible": false,
            "searchable": false
        }];
        var status = $("#statusType").val();
        if (status == "" || status == null) {
            status = 0;
        }
        else {
            status = status;
        }
        //Init General Datatable
        initGeneralDatatableByOrders('#table-orders', '/pagination/getTableData/6', columns, order, columnDefs, status, JSON.stringify(companyIds), JSON.stringify(chefIds));

        //initDatatable('#table-item', '/pagination/getTableData/1', '#statusType', '#pageTitleFilter', columns, order, columnDefs);

        //status button click functionality
        $('.buttons .btn-theme3').click(function () {
            let statusId = $(this).attr('data-statusId');
            console.log(statusId);

            $('.btn-theme3').removeClass('selectedButton');
            $(this).addClass('selectedButton');
            $('#statusType').val(statusId);

            //generating table according to status
            initGeneralDatatableByOrders('#table-orders', '/pagination/getTableData/6', columns, order, columnDefs, statusId, JSON.stringify(companyIds), JSON.stringify(chefIds));
        });

    });

    //Soft Delete Feature
    $('#table-orders tbody').on('click', '[id*=orderMarkBtn]', function () {
        //Get Row Data
        var data = table.row($(this).parents('tr')).data();

        var orderId = $(this).attr("data-orderId");
        var status = parseInt($(this).attr("data-status"));

        var title, confirmButtonText;

        if (status == 1) {
            title = 'Are you sure, you want to Mark this Order Complete?';
            confirmButtonText = 'Yes, Complete it!';
        }
        //else {
        //    title = 'Are you sure, you want to unblock this user?';
        //    confirmButtonText = 'Yes, Unblock it!';
        //}

        swal.fire({
            title: title,
            icon: 'warning',
            allowOutsideClick: false,
            showCloseButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            showCancelButton: true,
            confirmButtonText: confirmButtonText
        }).then((result) => {
            if (result.isConfirmed) {
                if (status == 1) {
                    loadHttpRequest("POST", "/Management/markOrderComplete?id=" + orderId + "&isStatus=" + status, softDeleteCallback);
                }
                //else {
                //    loadHttpRequest("POST", "/Management/softDeleteUser?id=" + userId + "&isStatus=" + status, softDeleteCallback);
                //}
            }
            else if (result.dismiss === Swal.DismissReason.cancel) {
                // Code to execute if "Cancel" is clicked
            }
        });
    });

    function softDeleteCallback(response) {
        Swal.fire({
            title: 'Successful',
            text: 'Order get Marked successfully.',
            icon: 'success',
            //imageUrl: '/content/dist/img/SwalSuccess.png',
            //imageAlt: 'Success Icon',
            timer: 1500,
            showCancelButton: false,
            showConfirmButton: false
        }).then(function () {
            table.draw();
        })
    }

    //Block Reason Handler
    $('#table-users tbody').on('click', '[id*=rejection_reason]', function () {
        //Get Row Data
        var data = $(this).attr("data-detail");
        $('#reason').html(data);
        $('#rejection_reason_modal').modal('show');
    });

    //show Company Feature
    function showOrderDetailModal(orderId) {
        $("#appendrequest").html("");
        $("#appendstars").html("");
        $("#appendstatus").html("");
        $("#timeslot").html("");
        $("#appendcategories").html("");

        $.ajax({
            type: 'GET',
            url: '/Management/GetOrderDetail?orderId=' + orderId,
            async: true,
            processData: false,
            contentType: false,
            success: function (res) {
                var order = "Order ID: " + res.orderId;
                $("#orderId").text(order);
                if (res.orderRating == 0) {
                    $("#appendstars").append(`<i class="fontcolor fas fa-star"></i>
                                    <i class="fontcolor fas fa-star"></i>
                                    <i class="fontcolor fas fa-star"></i>
                                    <i class="fontcolor fas fa-star"></i>
                                    <i class="fontcolor fas fa-star"></i>
                            `);
                }
                else if (res.orderRating == 1) {
                    $("#appendstars").append(`<i class="text-warning fas fa-star"></i>
                                        <i class="fontcolor fas fa-star"></i>
                                        <i class="fontcolor fas fa-star"></i>
                                        <i class="fontcolor fas fa-star"></i>
                                        <i class="fontcolor fas fa-star"></i>
                                `);
                }
                if (res.orderRating == 2) {
                    $("#appendstars").append(`<i class="text-warning fas fa-star"></i>
                                            <i class="text-warning fas fa-star"></i>
                                        <i class="fontcolor fas fa-star"></i>
                                        <i class="fontcolor fas fa-star"></i>
                                        <i class="fontcolor fas fa-star"></i>
                                `);
                }
                if (res.orderRating == 3) {
                    $("#appendstars").append(`<i class="text-warning fas fa-star"></i>
                                        <i class="text-warning fas fa-star"></i>
                                            <i class="text-warning fas fa-star"></i>
                                        <i class="fontcolor fas fa-star"></i>
                                        <i class="fontcolor fas fa-star"></i>
                                `);
                }
                if (res.orderRating == 4) {
                    $("#appendstars").append(`<i class="text-warning fas fa-star"></i>
                                                <i class="text-warning fas fa-star"></i>
                                                <i class="text-warning fas fa-star"></i>
                                                <i class="text-warning fas fa-star"></i>
                                            <i class="fontcolor fas fa-star"></i>
                                    `);
                }
                if (res.orderRating == 5) {
                    $("#appendstars").append(`<i class="text-warning fas fa-star"></i>
                                                <i class="text-warning fas fa-star"></i>
                                                <i class="text-warning fas fa-star"></i>
                                                <i class="text-warning fas fa-star"></i>
                                                <i class="text-warning fas fa-star"></i>
                                    `);
                }
                if (res.orderStatus == 0) {
                    $("#appendstatus").append(`<span class="spandefault rounded py-2 px-2" style="font-family: PoppinsFont;">&nbsp;&nbsp;Pending&nbsp;&nbsp;</span>`);
                }
                else {
                    $("#appendstatus").append(`<span class="bg-success rounded py-2 px-2" style="font-family: PoppinsFont;">Completed</span>`);
                }
                var time = "";
                if (CheckNullUndefined(res.timeSlot)) {
                    time = "No Time Slot";
                }
                else {
                    time = res.timeSlot;
                }
                $("#timeslot").append(`<span style="font-family: PoppinsFont;"> <b>${time}</b></span>`);
                var request = "";
                if (CheckNullUndefined(res.specialRequest)) {
                    request = "No Request";
                }
                else {
                    request = res.specialRequest;
                }
                $("#appendrequest").append(`<span style="font-family: PoppinsFont;">
                                    <b>${request}</b>
                                </span>`);

                if (res.orderItems != null) {
                    res.orderItems.forEach(item => {
                        var oitem = `<div class="row">
                                    <img src="${item.categoryIcon}" width: 25px;height: 25px;" />
                                            <span style="margin-left: 5px;margin-top: -2px; font-family: PoppinsFont;" class="heading"> ${item.categoryName}</span>
                            </div>
                            <div class="row mt-2">
                                    <span style="font-family: PoppinsFont;"> <b>${item.itemName}</b></span>

                            </div>`;
                        $("#appendcategories").append(oitem);
                    });
                }
                else {
                    $("#appendcategories").append('No Meal Found');
                }
            },
            error: function (error) {
                return error;
            },
        });

        //show modal
        $("#order_detail_modal").modal("toggle");
    }

    //show User Detail Feature
    function showUserDetailModal(userId) {
        $("#appendallergies").html("");
        $("#userImage").html("");

        $.ajax({
            type: 'GET',
            url: '/Management/GetUserDetail?userId=' + userId,
            async: true,
            processData: false,
            contentType: false,
            success: function (res) {
                var imageUrl = "";
                var phone = "";
                var email = "";
                var name = "";
                if (CheckNullUndefined(res.pictureUrl)) {
                    imageUrl = "/content/dist/img/user-dummy.png";
                }
                else {
                    imageUrl = res.pictureUrl;
                }

                //if (CheckNullUndefined(res.phoneNumber)) {
                //    phone = "N/A";
                //}
                //else {
                //    phone = res.phoneNumber;
                //}

                if (CheckNullUndefined(res.email)) {
                    email = "N/A";
                }
                else {
                    email = res.email;
                }

                if (CheckNullUndefined(res.fullName)) {
                    name = "N/A";
                }
                else {
                    name = res.fullName;
                }

                $("#userImage").append(`<img src="${imageUrl}" style = "padding : 3px; border:2px solid #a9b9c9; border-radius:60%;" width = "150" alt = "WarrenCatering" />`);
                $("#userName").text(name);
                $("#userEmail").text(email);
                //$("#userPhone").text(phone);


                if (res.allergies != null && res.allergies.length > 0) {
                    res.allergies.forEach(item => {
                        var allergy = `<span class="Alergies" style="font-family: PoppinsFontmedium;">&nbsp; ${item.name}</span>`;
                        $("#appendallergies").append(allergy);
                    });
                }
                else {
                    $("#appendallergies").append('No Allergy Found');
                }
            },
            error: function (error) {
                return error;
            },
        });

        //show modal
        $("#user-detail-modal").modal("toggle");
    }
    $('#btn-filter').click(function () {
        $.ajax({
            type: 'GET',
            url: '/Management/GetCompaniesandChefs',
            async: true,
            processData: false,
            contentType: false,
            success: function (res) {
                console.log(res);

                $('#company-list').empty();
                $('#chef-list').empty();
                $("#company-list").append(`<div class="text-center">
                                    <span id="notFoundMessageCompany" class="text-danger poppin-m lableFont text-center" style="display: none;">No Company Found!</span>

                                </div>`);
                $("#chef-list").append(`<div class="text-center">
                                        <span id="notFoundMessageChef" class="text-danger poppin-m lableFont text-center" style="display: none;">No Chef Found!</span>

                                    </div>`);
                for (let company of res.companies) {
                    if(companyIds != null && companyIds.length >0){
                        if (companyIds.includes(company.id.toString())) {
                            $('#company-list').append(
                                `<div class="dropdownitem "><div class="company poppin-m">
                                                                                <div class="company-checkbox">
                                                         <input type="checkbox" class="checkbox" value="${company.id}" id="company-${company.id}" name="company" checked>
                                                </div>
                                            <div class="company-info">
                                                                    <label for="company-${company.id}"title="${company.companyName}">${company.companyName.length > 15 ? `${company.companyName.slice(0, 15)}...` : company.companyName}</label>
                                            </div>
                                        </div>
                                       <hr /></div>`
                            );
                        }
                        else{
                            $('#company-list').append(
                                `<div class="dropdownitem "><div class="company poppin-m">
                                                                                <div class="company-checkbox">
                                                     <input type="checkbox" class="checkbox" value="${company.id}" id="company-${company.id}" name="company">
                                                </div>
                                            <div class="company-info">
                                                                        <label for="company-${company.id}"title="${company.companyName}">${company.companyName.length > 15 ? `${company.companyName.slice(0, 15)}...` : company.companyName}</label>
                                            </div>
                                        </div>
                                       <hr /></div>`
                            );
                        }
                    }
                    else{
                        $('#company-list').append(
                            `<div class="dropdownitem "><div class="company poppin-m">
                                                                        <div class="company-checkbox">
                                                 <input type="checkbox" class="checkbox" value="${company.id}" id="company-${company.id}" name="company">
                                            </div>
                                        <div class="company-info">
                                                                        <label for="company-${company.id}"title="${company.companyName}">${company.companyName.length > 15 ? `${company.companyName.slice(0, 15)}...` : company.companyName}</label>
                                        </div>
                                    </div>
                                   <hr /></div>`
                        );
                    }
                }
                for (let chef of res.chefs) {

                    if (chefIds != null && chefIds.length > 0) {
                        if (chefIds.includes(chef.id.toString())) {
                            $('#chef-list').append(
                                `<div class="dropdownitem"><div class="chef poppin-m">
                                                                                <div class="chef-checkbox">
                                                         <input type="checkbox" class="checkbox" value="${chef.id}" id="chef-${chef.id}" name="chef" checked>
                                                </div>
                                            <div class="chef-info">
                                                                <label for="chef-${chef.id}" title="${chef.chefName}">${chef.chefName.length > 15 ? `${chef.chefName.slice(0, 15)}...` : chef.chefName}</label>
                                            </div>
                                        </div>
                                        <hr /></div>`
                            );
                        }
                        else {
                            $('#chef-list').append(
                                `<div class="dropdownitem"><div class="chef poppin-m">
                                                                                <div class="chef-checkbox">
                                                     <input type="checkbox" class="checkbox" value="${chef.id}" id="chef-${chef.id}" name="chef">
                                                </div>
                                            <div class="chef-info">
                                                                    <label for="chef-${chef.id}" title="${chef.chefName}">${chef.chefName.length > 15 ? `${chef.chefName.slice(0, 15)}...` : chef.chefName}</label>
                                            </div>
                                        </div>
                                        <hr /></div>`
                            );
                        }
                    }
                    else {
                        $('#chef-list').append(
                            `<div class="dropdownitem"><div class="chef poppin-m">
                                                                            <div class="chef-checkbox">
                                                     <input type="checkbox" class="checkbox" value="${chef.id}" id="chef-${chef.id}" name="chef">
                                                </div>
                                            <div class="chef-info">
                                                                    <label for="chef-${chef.id}" title="${chef.chefName}">${chef.chefName.length > 15 ? `${chef.chefName.slice(0, 15)}...` : chef.chefName}</label>
                                            </div>
                                        </div>
                                        <hr /></div>`
                        );
                    }
                }

            },
            error: function (error) {
                return error;
            },
        });

        $('#filter-modal').modal('show');
    });

    function orderFilters(){
        companyIds = [];
        chefIds = [];
        $('input:checkbox[name=company]:checked').each(function () {
            if(companyIds != null && companyIds.length > 0){
                for(var i = 0; i< companyIds.length; i++){
                    var index = companyIds[i];
                    if(index != companyIds[i]){
                        companyIds.push($(this).val());
                    }
                }
            }
            else{
                companyIds.push($(this).val());
            }
        });
        console.log(companyIds);
        $('input:checkbox[name=chef]:checked').each(function () {
            if (chefIds != null && chefIds.length > 0) {
                for (var i = 0; i < chefIds.length; i++) {
                    var index = chefIds[i];
                    if (index != chefIds[i]) {
                        chefIds.push($(this).val());
                    }
                }
            }
            else {
                chefIds.push($(this).val());
            }
        });
        console.log(chefIds);

        var columns = [
            {
                "data": "id",
                "name": "id"
            },
            {
                "data": "orderId",
                "name": "orderId",
                "render": function (data, row, payload) {
                    return '<span>' + data + '</span>';
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    var imageUrl = "";
                    if (CheckNullUndefined(payload.userPic)) {
                        imageUrl = "/content/dist/img/user-dummy.png";
                    }
                    else {
                        imageUrl = payload.userPic;
                    }
                    return `<a style="cursor:pointer;" onclick="showUserDetailModal('${payload.userId}')"> <div class="user-block" style = "float: none!important;">
                                            <img class="img-circle" src ="${imageUrl}">
                                                <span class="username"> ${payload.userName}</span>
                                        </div></a>`;
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    return '<span>' + payload.timeSlot + '</span>';
                }
            },
            {
                "data": "mealName",
                "name": "mealName",
                "render": function (data, row, payload) {
                    return '<span>' + data + '</span>';
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    var choice = "";
                    if (CheckNullUndefined(payload.mealChoice)) {
                        choice = "N/A";
                    }
                    else {
                        choice = payload.mealChoice;
                    }
                    return '<span>' + choice + '</span>';
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    var choice = "";
                    if (CheckNullUndefined(payload.mealSide)) {
                        choice = "N/A";
                    }
                    else {
                        choice = payload.mealSide;
                    }
                    return '<span>' + choice + '</span>';
                }
            },
            {
                "data": "specialRequest",
                "name": "specialRequest",
                "render": function (data, row, payload) {
                    var rqeuest = "";
                    if (CheckNullUndefined(data)) {
                        request = "N/A";
                    }
                    else {
                        request = data;
                    }
                    return '<span>' + request + '</span>';
                }
            },
            //{
            //    "data": "chefName",
            //    "name": "chefName",
            //    "render": function (data, row, payload) {
            //        return '<span>' + data + '</span>';
            //    }
            //},
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    return '<span>' + payload.orderReceived + '</span>';
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    return '<span>' + payload.orderDelivered + '</span>';
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    if (payload.orderStatus == 0) {
                        return `<div class="no-wrap"style="text-align:center;">
                                                                                <div class="dropdown show">
                                                                                                      <a class="dropdown" href="#" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                                                                <span class="spandefault rounded py-2 px-2">&nbsp;&nbsp;&nbsp;Pending&nbsp;&nbsp;&nbsp;</span>
                                                                                                  </a>
                                                                                                  <div class="dropdown-menu dropopen" aria-labelledby="dropdownMenuLink">
                                                                                                        <a class="dropdown-item cursor-pointer" id="orderMarkBtn" data-orderId=${data} data-status=${1}>Mark Complete</a>
                                                                                                  </div>
                                                                                                </div>
                                                                                                </div>`;
                        //return '<div style="text-align:center;"><span class="spandefault rounded py-2 px-2">&nbsp;&nbsp;Pending&nbsp;&nbsp;</span></div>';
                    }
                    else {
                        return '<div style="text-align:center;"><span class="bg-success rounded py-2 px-2">Completed</span></div>';
                    }
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    return `<a title="OrderDetail" id="order_details" class="btn-sm btn-white-eye orderdetail" style="text-align:center; cursor: pointer;" onclick="showOrderDetailModal('${data}')"><i class="fas fa-eye"></i></a>`;
                }
            },
            {
                "data": "id",
                "name": "id",
                "render": function (data, row, payload) {
                    if (payload.orderRating == null) {
                        return '<span>Not yet</span>';
                    }
                    else {
                        if (payload.orderRating == 0) {
                            return '<span>Not yet</span>';
                        }
                        else {
                            return '<span><i class="text-warning fas fa-star"></i>' + payload.orderRating + '</span>';
                        }
                    }
                }
            }
        ];

        var order = [[0, "desc"]];
        var columnDefs = [{
            "targets": [0],
            "visible": false,
            "searchable": false
        }];
        var statusId = $("#statusType").val();
        if(statusId == "" || statusId == null){
            statusId = 0;
        }
        else{
            statusId = statusId;
        }
        //generating table according to status
        initGeneralDatatableByOrders('#table-orders', '/pagination/getTableData/6', columns, order, columnDefs, statusId, JSON.stringify(companyIds), JSON.stringify(chefIds));

        $('#filter-modal').modal('hide');
    }

    //$('#input-search').on('input', function () {
    //    var inputText = $(this).val().toLowerCase();

    //    $('.dropdown-item').each(function () {
    //        var label = $(this).text().toLowerCase();
    //        console.log(label);
    //        if (label.includes(inputText)) {
    //            $(this).show();
    //        }
    //        else {
    //            $(this).hide();
    //        }
    //    });
    //});
    $('#input-search').on('input', function () {
        var inputText = $(this).val().toLowerCase();

        // Check for the Company accordion
        var $companyItems = $('.accordion-content:eq(0) .dropdownitem');
        var $notFoundMessageCompany = $('#notFoundMessageCompany');

        // Check for the Chef accordion
        var $chefItems = $('.accordion-content:eq(1) .dropdownitem');
        var $notFoundMessageChef = $('#notFoundMessageChef');

        // Function to handle visibility and "Not Found" message
        function handleAccordionItems($items, $notFoundMessage) {
            var hasMatches = false;
            $items.each(function () {
                var label = $(this).text().toLowerCase();
                if (label.includes(inputText)) {
                    $(this).show();
                    hasMatches = true;
                } else {
                    $(this).hide();
                }
            });
            if (!hasMatches) {
                $notFoundMessage.show();
            } else {
                $notFoundMessage.hide();
            }
        }

        // Call the function for each accordion
        handleAccordionItems($companyItems, $notFoundMessageCompany);
        handleAccordionItems($chefItems, $notFoundMessageChef);
    });

    $('#company-dropdown').click(function () {
        // Toggle the 'd-none' class for the chevrons
        $('#comp-chevron-up, #comp-chevron-down').toggleClass('d-none');
    });

    $('#chef-dropdown').click(function () {
        // Toggle the 'd-none' class for the chevrons
        $('#chef-chevron-up, #chef-chevron-down').toggleClass('d-none');
    });
    $('#btnClearAll').click(function () {
        $('input[type="checkbox"]').prop('checked', false);
        $('#input-search').val('');
        companyIds = [];
        chefIds = [];
    });
    $('.accordion-header').click(function () {
        var chevron = $(this).find('.chevron');
        $(this).next('.accordion-content').slideToggle();
        chevron.toggleClass('rotate-chevron');
    });


    / script.js /
    $(document).ready(function () {
        $("#nav-order").addClass("active");
        // for changing image for orders
        $('#order-history-white, #order-history').toggleClass('d-none');
        $('.orderdetail').click(function () {
            $('#order-detail').modal('show');
        });
        $('#close-id13').click(function () {
            $('#order-detail').modal('hide');
        });
        $('#d-table3').DataTable();

        $(".horizontal-ellipsis").click(function () {
            $(".dropdown-content").toggle();
        });

        //$(document).click(function (event) {
        //    if (!$(event.target).closest(".dropdown").length) {
        //        $(".dropdown-content").hide();
        //    }
        //});
        //$('#btn-filter').click(function () {
        //    $('#filter-modal').modal('show');
        //});
        //$('#exampleDropdown').selectpicker();
    });

</script>
