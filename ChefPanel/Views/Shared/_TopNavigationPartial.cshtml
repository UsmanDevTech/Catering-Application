@using Domain.Models;
@using Infrastructure.Identity;
@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> userManager
@{
    var user = await userManager.GetUserAsync(User);
}
<style>

    @@media (max-width:834px) {
        .centerLogo {
            display: none;
        }
    }

    @@media(min-width:835px) and (max-width:900px) {
        .centerLogo {
            margin: 0px 7px 0px 90px;
        }
    }

    @@media(min-width:901px) and (max-width:1000px) {
        .centerLogo {
            margin: 0px 90px 0px 191px;
        }
    }

    @@media(min-width:1001px) and (max-width:1100px) {
        .centerLogo {
            margin: 0px 10px 0px 53px;
        }
    }

    @@media(min-width:1101px) and (max-width:1200px) {
        .centerLogo {
            margin: 0px 27px 0px 83px;
        }
    }

    @@media(min-width:1201px) and (max-width:1350px) {
        .centerLogo {
            margin: 0px 7px 0px 167px;
        }
    }

    @@media(min-width:1351px) and (max-width:1680px) {
        .centerLogo {
            margin: 0px 7px 0px 217px;
        }
    }

    @@media(min-width:1681px) {
        .centerLogo {
            margin: 0px 7px 0px 272px;
        }
    }

    .dropdown-toggle::after {
        vertical-align: 11px !important;
    }

    .mt-1, .my-1 {
        margin-top: 13px !important;
        font-size: 13px;
    }

    .centerLogo {
        width: 200px;
    }

    .nav-vertical-line {
        border-left: 2px solid #E6E8F2;
        margin-left: -14px;
    }

    .dropdown-toggle::after {
        content: none;
    }

    .custom-chevron-down {
        color: black;
        font-size: 9px;
        margin-top: 13px;
    }
</style>
<header style="background: #f9f9fb;">

    <div style="margin: 15px;background: #f9f9fb;">
        <nav class="main-header navbar navbar-expand navbar-white navbar-light" style="box-shadow:0px 0px 8px 0px #eee;border-radius: 10px;padding: 5px;">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button" id="bars"><img src="~/assets/Images/paragraph.png" style="width : 19px;" alt="Menu Image"></a>
                </li>
            </ul>
            <div class="mx-auto">
                <!-- Center the image -->
                <img src="~/Images/8635fdd8924cc8147a1acf51cf839324.png" class="centerLogo" alt="Logo">
            </div>

            <ul class="navbar-nav ml-auto">
                @*				<img src="~/images/Group 231137.png" class="" alt="notification" width="19px;" id="notification" style=" margin-right:20px; height: 21px;margin-top: 8px;">
                *@
                <li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#" onclick="ShowNotifications()" style="border-color: rgba(226,232,240,.6);   border-radius: 10px;margin-right: 10px;">
                        <img src="~/content/dist/img/notification.png" id="notify" style="font-size:20px;height:20px;">
                        <img src="~/content/dist/img/notificationred.png" id="notifyred" class="d-none" style="font-size:20px;height:20px;">
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg" style="border-radius:10px;" id="dropdownview">
                        <span class="dropdown-item dropdown-header poppin-m" style="text-align: inherit;">Notifications <span class="float-right" style="color:#53B5DF;font-family:Poppins-Medium;" id="notification_count">03</span></span>
                        <div id="notificationappend" style="height:300px;overflow-y:scroll;padding:10px;">
                            <a href="#" class="dropdown-item" style="background-color:#D8F3FF;">
                                <!-- Message Start -->
                                <div class="media">
                                    <img src="~/img/Group 1.png" alt="User Avatar" class=" mr-3 img-circle" style="width: 35px; height: 35px;">
                                    <div class="media-body">
                                        <h3 class="dropdown-item-title" style="color:#253243;font-size:15px;font-family:popinssemiboldfont;">
                                            Sasha Cohen
                                            <span class="text-muted" style="font-size:13px;color:#707070;font-family:Poppins-Regular;">Lorem ispum dolor sit</span>
                                        </h3>
                                        <p class="text-sm text-muted" style="color:#ababab;font-family:Poppins-Regular;">11 oct 2022 11:90am</p>
                                    </div>
                                </div>
                                <!-- Message End -->
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item">
                                <!-- Message Start -->
                                <div class="media">
                                    <img src="~/img/Group 1.png" alt="User Avatar" class=" img-circle mr-3" style="width: 35px;height: 35px;">
                                    <div class="media-body">
                                        <h3 class="dropdown-item-title" style="color:#253243;font-size:15px;font-family:popinssemiboldfont;">
                                            Sasha Cohen
                                            <span class="text-muted" style="font-size:13px;color:#707070;font-family:Poppins-Regular;">Lorem ispum dolor sit</span>
                                        </h3>
                                        <p class="text-sm text-muted" style="color:#ababab;font-family:Poppins-Regular;">11 oct 2022 11:90am</p>
                                    </div>
                                </div>
                                <!-- Message End -->
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item">
                                <!-- Message Start -->
                                <div class="media">
                                    <img src="~/img/Group 1.png" alt="User Avatar" class=" img-circle mr-3" style=" width: 35px; height: 35px;">
                                    <div class="media-body">
                                        <h3 class="dropdown-item-title" style="color:#253243;font-size:15px;font-family:popinssemiboldfont;">
                                            Sasha Cohen
                                            <span class="text-muted" style="font-size:13px;color:#707070;font-family:Poppins-Regular;">Lorem ispum dolor sit</span>
                                        </h3>
                                        <p class="text-sm text-muted" style="color:#ababab;font-family:Poppins-Regular;">11 oct 2022 11:90am</p>
                                    </div>
                                </div>s
                                <!-- Message End -->
                            </a>
                        </div>
                    </div>
                </li>
                <li style="margin-top: 7px;"><span class="nav-vertical-line"></span></li>
                <li class="nav-item dropdown dropdown user_profile mr-3" style="cursor:pointer;margin-top: 2px;">
                    <div class="dropdown-toggle" data-toggle="dropdown" aria-expanded="true">
                        <div class="d-inline-flex">
                            <img class="imageUrl rounded-circle mr-3 shadow-sm" src="@user?.ImageUrl" width="32" height="32">
                            <div class="info mt-1">
                                <span href="#" class="d-block poppin-m" style="line-height: 0.7;">
                                    @(user?.FullName.Length > 15 ? user?.FullName.Substring(0, 15) + "..." : user?.FullName)
                                </span>
                            </div>
                            <span class="custom-chevron-down ml-2">
                                <i class="fas fa-chevron-down"></i> <!-- Add the chevron-down icon here -->
                            </span>
                        </div>
                    </div>
                    <ul class="dropdown-menu pullDown">
                        <li class="body">
                            <ul class="user_dw_menu p-0">
                                <li style="list-style:none;">
                                    <a class="dropdown-item  poppin-m" title="Profile" href="/Accounts/Profile">
                                        My Account
                                        <i class="fas fa-user float-right" style="color:#77D4FC;margin-top: 3px;"></i>
                                    </a>
                                </li>
                                <hr />
                                <li style="list-style:none;" class="d-none">
                                    <a class="dropdown-item  poppin-m" title="Setting" asp-page="/setting/index">
                                        Setting
                                        <i class="fas fa-cogs float-right text-black"></i>

                                    </a>
                                </li>
                                <li style="list-style:none">
                                    <form method="post" asp-controller="accounts" asp-action="logout" id="logout-form">
                                        <a href="/accounts/logout" class="mega-menu dropdown-item  poppin-m">Logout<i class="fas fa-sign-out-alt float-right" style="color: #77D4FC;margin-top: 3px;"></i></a>
                                    </form>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>
</header>
<div id="modal-notification" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title"></h4>
            </div>
            <div class="modal-body">
                <h1>Notifications</h1><br />

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-theme" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>

<div class="modal fade" id="notification-id" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">

            <div class="modal-body">

                <div style="text-align : left;">
                    <title > style="font-size: 20px">Notification</title>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <img src="/assets/Images/dp2.png" />
                    </div>
                    <div class="col-md-9">
                        <span></span>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('#notification').click(function () {
            $('#notification-id').modal('show');
        });

        $.ajax({
            type: 'GET',
            url: '/Management/GetNotificationCount',
            async: true,
            processData: false,
            contentType: false,
            success: function (res) {
                if (res == true) {
                    $("#notifyred").removeClass('d-none');
                    $("#notify").addClass('d-none');
                }
                else {
                    $("#notifyred").addClass('d-none');
                    $("#notify").removeClass('d-none');
                }
            },
            error: function (error) {
                return error;
            },
        });
    });

    function ShowNotifications() {
        if ($("#dropdownview").hasClass('show')) {
            loaderDiv.innerHTML = '';
        }
        else {
            $("#notificationappend").html("");
            $("#notification_count").html(00);
            loaderDiv.innerHTML = '<div class="loading">Loading&#8230;</div>';
            $.ajax({
                type: 'GET',
                url: '/Management/GetNotifications',
                async: true,
                processData: false,
                contentType: false,
                success: function (res) {
                    if (res != null) {
                        loaderDiv.innerHTML = '';
                        $("#notification_count").html(res.length);
                        $("#notifyred").addClass('d-none');
                        $("#notify").removeClass('d-none');
                        res.forEach(item => {
                            if (item.isSeen == false) {
                                var imageUrl = "";
                                if (CheckNullUndefined(item.userPic)) {
                                    imageUrl = "/content/dist/img/user-dummy.png";
                                }
                                else {
                                    imageUrl = item.userPic;
                                }
                                var markup = `<a href="#" class="dropdown-item mb-2" style="border-radius: 10px;background: #53B5DF;">
                                                                                    <!-- Message Start -->
                                                                                    <div class="media">
                                                                                        <img src="${imageUrl}" alt="User Avatar" class=" mr-2 img-circle" style="width: 45px; height: 45px;">
                                                                                        <div class="media-body">
                                                                                            <h3 class="dropdown-item-title" style="color:#253243;font-size:15px;font-family:poppinsfont;">
                                                                                                <b title="${item.userName}">${item.userName.length > 15 ? `${item.userName.slice(0, 15)}...` : item.userName}</b>
                                                                                                <span class="text-muted" style="font-size:13px;color:#707070;font-family:Poppins-Regular;"></span>
                                                                                            </h3>
                                                                                                <p class="text-sm text-muted" style="color:#ababab;font-family:Poppins-Regular;line-height:1;max-width: 190px;word-wrap: break-word;">${item.description}</p>
                                                                                        </div>
                                                                                    </div>
                                                                                    <!-- Message End -->
                                                                                </a>`;
                                $("#notificationappend").append(markup);
                            }
                            else {
                                var imageUrl = "";
                                if (CheckNullUndefined(item.userPic)) {
                                    imageUrl = "/content/dist/img/user-dummy.png";
                                }
                                else {
                                    imageUrl = item.userPic;
                                }
                                var markup = `<a href="#" class="dropdown-item mb-2" style="border-radius: 10px;background: #f7f8f9;">
                                                                                    <!-- Message Start -->
                                                                                    <div class="media">
                                                                                        <img src="${imageUrl}" alt="User Avatar" class=" mr-2 img-circle" style="width: 45px; height: 45px;">
                                                                                        <div class="media-body">
                                                                                            <h3 class="dropdown-item-title" style="color:#253243;font-size:15px;font-family:poppinsfont;">
                                                                                                <b title="${item.userName}">${item.userName.length > 15 ? `${item.userName.slice(0, 15)}...` : item.userName}</b>
                                                                                                <span class="text-muted" style="font-size:13px;color:#707070;font-family:Poppins-Regular;"></span>
                                                                                            </h3>
                                                                                                <p class="text-sm text-muted" style="color:#ababab;font-family:Poppins-Regular;line-height:1;max-width: 190px;word-wrap: break-word;">${item.description}</p>
                                                                                        </div>
                                                                                    </div>
                                                                                    <!-- Message End -->
                                                                                </a>`;
                                $("#notificationappend").append(markup);
                            }
                        });
                    }
                    else {
                        $("#notification_count").html(0);
                        $("#notificationappend").html("No Notification Found!")
                    }
                },
                error: function (error) {
                    return error;
                },
            });
        }
    }
</script>